# url-shortener

Этот проект представляет собой микросервис, который преобразует длинные URL в сокращенные ссылки и предоставляет возможность перенаправления по ним. Он поддерживает хранение данных в базе данных PostgreSQL, а также в памяти. Сервис кэширует данные для улучшения производительности и обеспечивает уникальность коротких ссылок.

## Содержание
- [Функциональность](#функциональность)
- [Установка](#установка)
- [Использование](#использование)
- [Api](#api)
- [Тестирование](#тестирование)

## Функциональность
- Сокращение URL: Преобразование длинного URL в короткий.
- Перенаправление: Редирект пользователя на исходный URL по короткой ссылке.
- Валидация: Проверка входных данных на валидность.
- Хранение данных: Поддержка двух типов хранилищ:
    - База данных PostgreSQL.
    - Временное хранилище в памяти.
- Кэширование: Использование кэша для быстрого доступа к данным (при работе с PostgreSQL).
- Уникальность: Гарантия уникальности коротких ссылок.

## Установка

#### Требования
Для установки и запуска проекта, необходим [Golang](https://go.dev) v1.20+.

#### Клонирование репозитория:
```bash
git clone https://github.com/alsadx/url-shortener.git
cd url-shortener
```

#### Настройка конфигурации
В файле config/local.yaml настройте параметры:
```yaml
storage: "inmemory" # "inmemory" or "postgres"
db:
  name: "db_name"
  user: "user_name"
  password: ""
  host: "localhost"
  port: "5432"
http_server:
  address: ":8080"
  timeout: 5s
  idle_timeout: 20s
```
##### Параметры конфигурации:
- storage: Выбор типа хранилища (inmemory или postgres).
- db: Настройки подключения к базе данных PostgreSQL (используются только при выборе postgres).
    - name: Имя базы данных.
    - user: Имя пользователя базы данных.
    - password: Пароль пользователя базы данных.
    - host: Хост базы данных.
    - port: Порт базы данных.
- http_server: Настройки HTTP-сервера.
    - address: Адрес сервера (например, :8080).
    - timeout: Таймаут на чтение запроса и отправку ответа.
    - idle_timeout: Время жизни соединения с клиентом.

#### Путь до файла конфигурации
Не забудьте установить пусть до файла:
```bash
export CONFIG_PATH="path/to/config/local.yaml"
```
Проверить путь можно командой:
```bash
echo $CONFIG_PATH
```

#### Установка зависимостей
```bash
go mod download
```

#### Создание билда
Чтобы выполнить сборку, перейдите в директорию cmd/url-shortener и выполните команду: 
```bash
go build
```

#### Запуск сервера
```bash
./url-shortener
```
Приложение будет доступно по адресу: http://localhost:{ваш порт} (по умолчанию порт 8080)

## Использование
#### Создание короткой ссылки
Отправьте POST-запрос с JSON-телом:
```bash
curl -X POST http://localhost:8080/save \
     -H "Content-Type: application/json" \
     -d '{"url": "https://example.com"}'
```

Ответ:
```bash
{
    "shortUrl": "qgcVvTPN43"
}
```

#### Перенаправление по короткой ссылке
Перейдите по короткой ссылке в браузере (по адресу http://localhost:8080/tinyurl/{shortUrl}) или отправьте GET-запрос:
```bash
curl http://localhost:8080/tinyurl/qgcVvTPN43
```

## Api

#### POST `/save`
Сохраняет оригинальный URL в базе и возвращает сокращённый
Request body:
```json
{
  "url": "https://example.com"
}
```
Response:
```json
{
  "short_url": "qgcVvTPN43"
}
```

#### GET `/tinyurl/:alias`
Перенаправляет на исходный URL.


## Тестирование
Тесты находятся в папке tests. Для запуска теста выполните:
```sh
go test ./... -v
```